heat_template_version: 2018-08-31

description: Creating Handson image

parameters:
  reposerver:
    type: string
    label: hands-on repository server
    description: Teahcer will give the specific ip address.

resources:
  wait_handle:
    type: OS::Heat::WaitConditionHandle

  wait_condition:
    type: OS::Heat::WaitCondition
    properties:
      handle: { get_resource: wait_handle }
      count: 1
      timeout: 3600

  neutron-port:
    type: OS::Neutron::Port
    properties:
      network: build-net
      fixed_ips:
        - ip_address: 192.168.188.101
      security_groups:
        - open-all

  floating_ip:
    type: OS::Neutron::FloatingIP
    properties:
      floating_network: public

  floating_ip_assoc:
    type: OS::Neutron::FloatingIPAssociation
    properties:
      floatingip_id: { get_resource: floating_ip }
      port_id: { get_resource: neutron-port }

  config_set_passwd:
    type: OS::Heat::CloudConfig
    properties:
      cloud_config:
        timezone: Asia/Tokyo

  config_set_reposerver:
    type: OS::Heat::SoftwareConfig
    properties:
      config:
        str_replace:
          params:
            __heat_reposerver_ip: { get_param: reposerver }
            __heat_wc_notify: { get_attr: ['wait_handle', 'curl_cli'] }
          template: |
            #!/bin/bash -ex
            sed -i 's/^SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
            REPOSERVER=__heat_reposerver_ip
            dnf clean all
            rm -rf /etc/yum.repos.d/CentOS-Linux-*
            curl -o /etc/yum.repos.d/edubase.repo http://${REPOSERVER}/repos/edubase.repo
            echo "${REPOSERVER} reposerver" >> /etc/hosts
            if ping -c 1 reposerver &> /dev/null
            then
              echo connecting reposerver
            else
              __heat_wc_notify --data-binary '{"status": "FAILURE"}'
              exit 1
            fi
            dnf repolist

  config_init_config:
    type: OS::Heat::SoftwareConfig
    properties:
      config:
        str_replace:
          params:
            __heat_wc_notify: { get_attr: ['wait_handle', 'curl_cli'] }
          template: |
            #!/bin/bash -ex
            echo "LANG=en_US.utf-8" > /etc/environment
            echo "LC_ALL=en_US.utf-8" >> /etc/environment
            dnf update -y
            dnf install -y crudini qemu-kvm bash-completion git wget vim
            dnf install -y adobe-mappings-cmap-20171205-3.el8.noarch adobe-mappings-cmap-deprecated-20171205-3.el8.noarch adobe-mappings-pdf-20180407-1.el8.noarch adwaita-cursor-theme-3.28.0-2.el8.noarch adwaita-icon-theme-3.28.0-2.el8.noarch apr-1.6.3-11.el8.x86_64 apr-util-1.6.1-6.el8.x86_64 apr-util-bdb-1.6.1-6.el8.x86_64 apr-util-openssl-1.6.1-6.el8.x86_64 atk-2.28.1-1.el8.x86_64 at-spi2-atk-2.26.2-1.el8.x86_64 at-spi2-core-2.28.0-1.el8.x86_64 attr-2.4.48-3.el8.x86_64 autogen-libopts-5.18.12-8.el8.x86_64 avahi-libs-0.7-20.el8.x86_64 binutils-2.30-93.el8.x86_64 blosc-1.17.0-1.el8.x86_64 bootswatch-common-3.3.7.0-11.el8.noarch bootswatch-fonts-3.3.7.0-11.el8.noarch bridge-utils-1.6-4.el8.x86_64 centos-logos-httpd-85.8-1.el8.noarch colord-libs-1.4.2-1.el8.x86_64 conntrack-tools-1.4.4-10.el8.x86_64 container-selinux-2.164.1-1.module_el8.4.0+886+c9a8d9ad.noarch cryptsetup-2.3.3-4.el8.x86_64 cups-libs-2.2.6-38.el8.x86_64 cyrus-sasl-2.1.27-5.el8.x86_64 cyrus-sasl-gssapi-2.1.27-5.el8.x86_64 dconf-0.28.0-4.el8.x86_64 dejavu-sans-fonts-2.35-7.el8.noarch desktop-file-utils-0.23-8.el8.x86_64 device-mapper-event-1.02.175-5.el8.x86_64 device-mapper-event-libs-1.02.175-5.el8.x86_64 device-mapper-multipath-0.8.4-10.el8.x86_64 device-mapper-persistent-data-0.8.5-4.el8.x86_64 dibbler-client-1.0.1-10.el8.x86_64 dnsmasq-2.79-15.el8.x86_64 dnsmasq-utils-2.79-15.el8.x86_64 dosfstools-4.1-6.el8.x86_64 erlang-asn1-22.3.4.1-1.el8.x86_64 erlang-common_test-22.3.4.1-1.el8.x86_64 erlang-compiler-22.3.4.1-1.el8.x86_64 erlang-crypto-22.3.4.1-1.el8.x86_64 erlang-cuttlefish-2.0.11-10.el8.noarch erlang-debugger-22.3.4.1-1.el8.x86_64 erlang-eldap-22.3.4.1-1.el8.x86_64 erlang-erts-22.3.4.1-1.el8.x86_64 erlang-et-22.3.4.1-1.el8.x86_64 erlang-eunit-22.3.4.1-1.el8.x86_64 erlang-getopt-1.0.1-8.el8.noarch erlang-goldrush-0.2.0-6.el8.noarch erlang-hipe-22.3.4.1-1.el8.x86_64 erlang-inets-22.3.4.1-1.el8.x86_64 erlang-kernel-22.3.4.1-1.el8.x86_64 erlang-lager-3.8.0-2.el8.noarch erlang-mnesia-22.3.4.1-1.el8.x86_64 erlang-mustache-0.1.1-14.el8.noarch erlang-observer-22.3.4.1-1.el8.x86_64 erlang-os_mon-22.3.4.1-1.el8.x86_64 erlang-public_key-22.3.4.1-1.el8.x86_64 erlang-runtime_tools-22.3.4.1-1.el8.x86_64 erlang-sasl-22.3.4.1-1.el8.x86_64 erlang-sd_notify-1.0-14.1.el8.x86_64 erlang-snmp-22.3.4.1-1.el8.x86_64 erlang-ssh-22.3.4.1-1.el8.x86_64 erlang-ssl-22.3.4.1-1.el8.x86_64 erlang-stdlib-22.3.4.1-1.el8.x86_64 erlang-syntax_tools-22.3.4.1-1.el8.x86_64 erlang-tools-22.3.4.1-1.el8.x86_64 erlang-wx-22.3.4.1-1.el8.x86_64 erlang-xmerl-22.3.4.1-1.el8.x86_64 firewalld-filesystem-0.8.2-7.el8_4.noarch fontawesome-fonts-4.7.0-4.el8.noarch fontawesome-fonts-web-4.7.0-4.el8.noarch fuse-2.9.7-12.el8.x86_64 fuse-common-3.2.1-12.el8.x86_64 galera-25.3.32-1.module_el8.3.0+757+d382997d.x86_64 gd-2.2.5-7.el8.x86_64 gdk-pixbuf2-modules-2.36.12-5.el8.x86_64 genisoimage-1.1.11-39.el8.x86_64 glusterfs-cli-6.0-49.1.el8.x86_64 gnutls-dane-3.6.14-8.el8_3.x86_64 gnutls-utils-3.6.14-8.el8_3.x86_64 google-droid-sans-fonts-20120715-13.el8.noarch graphviz-2.40.1-40.el8.x86_64 gtk2-2.24.32-5.el8.x86_64 gtk3-3.22.30-6.el8.x86_64 gtk-update-icon-cache-3.22.30-6.el8.x86_64 haproxy-1.8.27-2.el8.x86_64 hdf5-1.10.5-5.el8.x86_64 hicolor-icon-theme-0.17-2.el8.noarch hivex-1.3.18-21.module_el8.4.0+885+5e18b468.x86_64 httpd-2.4.37-39.module_el8.4.0+778+c970deab.x86_64 httpd-filesystem-2.4.37-39.module_el8.4.0+778+c970deab.noarch httpd-tools-2.4.37-39.module_el8.4.0+778+c970deab.x86_64 ipmitool-1.8.18-17.el8.x86_64 iproute-tc-5.9.0-4.el8.x86_64 ipset-7.1-1.el8.x86_64 ipset-libs-7.1-1.el8.x86_64 iptables-1.8.4-17.el8.x86_64 iptables-ebtables-1.8.4-17.el8.x86_64 iptables-services-1.8.4-17.el8.x86_64 iscsi-initiator-utils-6.2.1.2-1.gita8fcb37.el8.x86_64 iscsi-initiator-utils-iscsiuio-6.2.1.2-1.gita8fcb37.el8.x86_64 isns-utils-libs-0.99-1.el8.x86_64 jasper-libs-2.0.14-4.el8.x86_64 jbig2dec-libs-0.16-1.el8.x86_64 jbigkit-libs-2.1-14.el8.x86_64 jq-1.5-12.el8.x86_64 keepalived-2.1.5-6.el8.x86_64 lcms2-2.9-2.el8.x86_64 libaec-1.0.2-3.el8.x86_64 liberasurecode-1.6.0-4.el8.x86_64 libev-4.24-6.el8.x86_64 libfontenc-1.1.3-8.el8.x86_64 libgfortran-8.4.1-1.el8.x86_64 libgs-9.27-1.el8.x86_64 libguestfs-1.44.0-2.el8.x86_64 libgusb-0.3.0-1.el8.x86_64 libICE-1.0.9-15.el8.x86_64 libidn-1.34-5.el8.x86_64 libijs-0.35-5.el8.x86_64 libmcpp-2.7.2-20.el8.x86_64 libmspack-0.7-0.3.alpha.el8.4.x86_64 libnetfilter_conntrack-1.0.6-5.el8.x86_64 libnetfilter_cthelper-1.0.0-15.el8.x86_64 libnetfilter_cttimeout-1.0.0-11.el8.x86_64 libnetfilter_queue-1.0.4-3.el8.x86_64 libnfnetlink-1.0.1-13.el8.x86_64 libnftnl-1.1.5-4.el8.x86_64 libosinfo-1.9.0-1.el8.x86_64 libpaper-1.1.24-22.el8.x86_64 libqhull-7.2.1-2.el8.x86_64 libquadmath-8.4.1-1.el8.x86_64 librsvg2-2.42.7-4.el8.x86_64 libSM-1.2.3-1.el8.x86_64 libsodium-1.0.18-2.el8.x86_64 libtiff-4.0.9-18.el8.x86_64 libtool-ltdl-2.4.6-25.el8.x86_64 libtpms-0.7.4-4.20201106git2452a24dab.el8.x86_64 libunwind-1.3.1-3.el8.x86_64 libusal-1.1.11-39.el8.x86_64 libvirt-bash-completion-7.0.0-14.1.el8.x86_64 libvirt-client-7.0.0-14.1.el8.x86_64 libvirt-daemon-7.0.0-14.1.el8.x86_64 libvirt-daemon-config-nwfilter-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-interface-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-network-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-nodedev-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-nwfilter-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-qemu-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-secret-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-core-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-disk-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-gluster-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-iscsi-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-iscsi-direct-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-logical-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-mpath-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-rbd-7.0.0-14.1.el8.x86_64 libvirt-daemon-driver-storage-scsi-7.0.0-14.1.el8.x86_64 libvirt-daemon-kvm-7.0.0-14.1.el8.x86_64 libvirt-libs-7.0.0-14.1.el8.x86_64 libwebp-1.0.0-3.el8_4.x86_64 libXaw-1.0.13-10.el8.x86_64 libXcomposite-0.4.4-14.el8.x86_64 libXcursor-1.1.15-3.el8.x86_64 libXi-1.7.10-1.el8.x86_64 libXinerama-1.1.4-1.el8.x86_64 libXmu-1.1.3-1.el8.x86_64 libXpm-3.5.12-8.el8.x86_64 libXrandr-1.5.2-1.el8.x86_64 libxslt-1.1.32-6.el8.x86_64 libXt-1.1.5-12.el8.x86_64 libXtst-1.2.3-7.el8.x86_64 libXxf86misc-1.0.4-1.el8.x86_64 lksctp-tools-1.0.18-3.el8.x86_64 lm_sensors-libs-3.4.0-22.20180522git70f7e08.el8.x86_64 lsof-4.93.2-1.el8.x86_64 lvm2-2.03.11-5.el8.x86_64 lvm2-libs-2.03.11-5.el8.x86_64 lzop-1.03-20.el8.x86_64 mailcap-2.1.48-3.el8.noarch mariadb-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-backup-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-common-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-connector-c-3.1.11-2.el8_3.x86_64 mariadb-connector-c-config-3.1.11-2.el8_3.noarch mariadb-errmsg-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-gssapi-server-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-server-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-server-galera-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mariadb-server-utils-10.3.28-1.module_el8.3.0+757+d382997d.x86_64 mcpp-2.7.2-20.el8.x86_64 mdadm-4.1-16.el8_4.x86_64 mdevctl-0.78-1.el8.noarch mdi-common-1.4.57.0-13.el8.noarch mdi-fonts-1.4.57.0-13.el8.noarch memcached-1.5.22-2.el8.x86_64 mesa-libGLU-9.0.0-15.el8.x86_64 mod_http2-1.15.7-3.module_el8.4.0+778+c970deab.x86_64 mtools-4.0.18-14.el8.x86_64 netcf-libs-0.2.8-12.module_el8.4.0+783+f8734d30.x86_64 net-snmp-agent-libs-5.8-20.el8.x86_64 net-snmp-libs-5.8-20.el8.x86_64 network-scripts-openvswitch-2.12.0-1.1.el8.x86_64 nftables-0.9.3-18.el8.x86_64 nmap-ncat-7.70-5.el8.x86_64 nodejs-10.24.0-1.module_el8.3.0+717+fa496f1d.x86_64 nodejs-full-i18n-10.24.0-1.module_el8.3.0+717+fa496f1d.x86_64 novnc-1.1.0-6.el8.noarch npm-6.14.11-1.10.24.0.1.module_el8.3.0+717+fa496f1d.x86_64 numad-0.5-26.20150602git.el8.x86_64 oniguruma-6.8.2-2.el8.x86_64 openblas-0.3.12-1.el8.x86_64 openblas-threads-0.3.12-1.el8.x86_64 openjpeg2-2.3.1-6.el8.x86_64 openpgm-5.2.122-21.el8.x86_64 openstack-cinder-15.6.0-1.el8.noarch openstack-dashboard-16.2.2-1.el8.noarch openstack-dashboard-theme-16.2.2-1.el8.noarch openstack-glance-19.0.4-1.el8.noarch openstack-keystone-16.0.2-1.el8.noarch openstack-neutron-15.3.4-1.el8.noarch openstack-neutron-common-15.3.4-1.el8.noarch openstack-neutron-ml2-15.3.4-1.el8.noarch openstack-nova-api-20.6.0-1.el8.noarch openstack-nova-common-20.6.0-1.el8.noarch openstack-nova-compute-20.6.0-1.el8.noarch openstack-nova-conductor-20.6.0-1.el8.noarch openstack-nova-migration-20.6.0-1.el8.noarch openstack-nova-novncproxy-20.6.0-1.el8.noarch openstack-nova-scheduler-20.6.0-1.el8.noarch openstack-placement-api-2.0.1-1.el8.noarch openstack-placement-common-2.0.1-1.el8.noarch openstack-selinux-0.8.26-1.el8.noarch openstack-swift-account-2.23.3-1.el8.noarch openstack-swift-container-2.23.3-1.el8.noarch openstack-swift-object-2.23.3-1.el8.noarch openstack-swift-proxy-2.23.3-1.el8.noarch openvswitch-2.12.0-1.1.el8.x86_64 osinfo-db-20210215-1.el8.noarch osinfo-db-tools-1.9.0-1.el8.x86_64 ovn-2.12.0-10.el8.x86_64 ovn-central-2.12.0-10.el8.x86_64 ovn-host-2.12.0-10.el8.x86_64 perl-DBD-MySQL-4.046-3.module_el8.1.0+203+e45423dc.x86_64 perl-DBI-1.641-3.module_el8.1.0+199+8f0a6bbd.x86_64 perl-Math-BigInt-1.9998.11-7.el8.noarch perl-Math-Complex-1.59-419.el8_4.1.noarch platform-python-devel-3.6.8-37.el8.x86_64 python3-alembic-1.3.1-1.el8.noarch python3-amqp-2.5.2-2.el8.noarch python3-aniso8601-8.0.0-1.el8.noarch python3-appdirs-1.4.3-12.el8.noarch python3-attrs-17.4.0-6.el8.noarch python3-automaton-1.17.0-1.el8.noarch python3-barbicanclient-4.9.0-2.el8.noarch python3-bcrypt-3.1.7-3.el8.x86_64 python3-beautifulsoup4-4.8.2-1.el8.noarch python3-boto-2.49.0-4.el8.noarch python3-Bottleneck-1.2.1-13.el8.x86_64 python3-bson-3.7.0-1.module_el8.4.0+679+437db172.x86_64 python3-cachetools-4.0.0-1.el8.noarch python3-castellan-1.3.4-1.el8.noarch python3-ceilometermiddleware-1.5.0-2.el8.noarch python3-cinder-15.6.0-1.el8.noarch python3-cinderclient-5.0.2-1.el8.noarch python3-click-6.7-8.el8.noarch python3-cliff-2.16.0-2.el8.noarch python3-cmd2-0.9.16-2.el8.noarch python3-colorama-0.4.1-4.el8.noarch python3-configshell-1.1.28-1.el8.noarch python3-contextlib2-0.5.5-12.el8.noarch python3-cursive-0.2.2-1.el8.noarch python3-cycler-0.10.0-13.el8.noarch python3-debtcollector-1.22.0-2.el8.noarch python3-defusedxml-0.6.0-4.el8.noarch python3-designateclient-3.0.0-1.el8.noarch python3-django-2.0.13-1.el8.noarch python3-django-appconf-1.0.3-1.el8.noarch python3-django-babel-0.6.2-10.el8.noarch python3-django-compressor-2.2-8.el8.noarch python3-django-debreach-2.0.1-1.el8.noarch python3-django-horizon-16.2.2-1.el8.noarch python3-django-pyscss-2.0.2-14.el8.noarch python3-dns-1.15.0-10.el8.noarch python3-dogpile-cache-0.9.0-1.el8.noarch python3-editor-1.0.4-4.el8.noarch python3-etcd3gw-0.2.5-1.el8.noarch python3-eventlet-0.25.2-3.1.el8.noarch python3-fasteners-0.14.1-20.el8.noarch python3-flask-1.1.1-1.el8.noarch python3-flask-restful-0.3.7-5.el8.noarch python3-fluidity-sm-0.2.0-16.el8.noarch python3-funcsigs-1.0.2-17.el8.noarch python3-future-0.18.2-3.el8.noarch python3-futurist-1.9.0-2.el8.noarch python3-gevent-1.2.2-4.el8.x86_64 python3-glance-19.0.4-1.el8.noarch python3-glanceclient-2.17.1-1.el8.noarch python3-glance-store-1.0.1-1.el8.noarch python3-google-api-client-1.6.7-10.el8.noarch python3-greenlet-0.4.13-4.el8.x86_64 python3-html5lib-0.999999999-6.el8.noarch python3-httplib2-0.10.3-4.el8.noarch python3-importlib-metadata-0.23-1.el8.noarch python3-inotify-0.9.6-13.el8.noarch python3-invoke-1.4.0-1.el8.noarch python3-iso8601-0.1.11-16.el8.noarch python3-itsdangerous-0.24-14.el8.noarch python3-jeepney-0.4.3-1.el8.noarch python3-jmespath-0.9.0-11.el8.noarch python3-kazoo-2.5.0-7.el8.noarch python3-keyring-21.0.0-1.el8.noarch python3-keystone-16.0.2-1.el8.noarch python3-keystoneauth1-3.17.4-1.el8.noarch python3-keystoneclient-3.21.0-2.el8.noarch python3-keystonemiddleware-7.0.1-2.el8.noarch python3-kiwisolver-1.1.0-4.el8.x86_64 python3-kmod-0.9-20.el8.x86_64 python3-kombu-4.6.6-2.el8.noarch python3-ldap-3.3.1-1.el8.x86_64 python3-ldappool-2.4.0-5.el8.noarch python3-lesscpy-0.13.0-12.el8.noarch python3-lexicon-1.0.0-9.el8.noarch python3-libguestfs-1.44.0-2.el8.x86_64 python3-libvirt-7.0.0-1.el8.x86_64 python3-logutils-0.3.5-11.el8.noarch python3-lxml-4.2.3-2.el8.x86_64 python3-mako-1.0.6-13.el8.noarch python3-matplotlib-3.1.1-2.el8.x86_64 python3-matplotlib-data-3.1.1-2.el8.noarch python3-matplotlib-data-fonts-3.1.1-2.el8.noarch python3-matplotlib-tk-3.1.1-2.el8.x86_64 python3-memcached-1.58-11.el8.noarch python3-microversion-parse-0.2.1-1.el8.noarch python3-migrate-0.13.0-1.el8.noarch python3-mock-3.0.5-7.el8.noarch python3-mod_wsgi-4.6.4-4.el8.x86_64 python3-monotonic-1.5-5.el8.noarch python3-msgpack-0.6.2-1.el8.x86_64 python3-munch-2.3.2-6.el8.noarch python3-networking-ovn-7.4.1-1.el8.noarch python3-networking-ovn-metadata-agent-7.4.1-1.el8.noarch python3-networkx-2.3-5.el8.noarch python3-neutron-15.3.4-1.el8.noarch python3-neutronclient-6.14.1-1.el8.noarch python3-neutron-lib-1.29.1-1.el8.noarch python3-nova-20.6.0-1.el8.noarch python3-novaclient-15.1.1-1.el8.noarch python3-numexpr-2.7.1-1.el8.x86_64 python3-numpy-1.14.3-9.el8.x86_64 python3-numpy-f2py-1.14.3-9.el8.x86_64 python3-oauth2client-4.1.3-8.el8.noarch python3-octavia-lib-1.4.0-1.el8.noarch python3-openstackclient-4.0.2-1.el8.noarch python3-openstacksdk-0.36.5-1.el8.noarch python3-openvswitch-2.12.0-1.1.el8.x86_64 python3-os-brick-2.10.7-2.el8.noarch python3-osc-lib-1.14.1-2.el8.noarch python3-os-client-config-1.33.0-2.el8.noarch python3-os-ken-0.4.1-1.el8.noarch python3-oslo-cache-1.37.1-1.el8.noarch python3-oslo-concurrency-3.30.1-1.el8.noarch python3-oslo-config-6.11.3-1.el8.noarch python3-oslo-context-2.23.1-1.el8.noarch python3-oslo-db-5.0.2-2.el8.noarch python3-oslo-i18n-3.24.0-2.el8.noarch python3-oslo-log-3.44.3-1.el8.noarch python3-oslo-messaging-10.2.4-1.el8.noarch python3-oslo-middleware-3.38.1-2.el8.noarch python3-oslo-policy-2.3.4-1.el8.noarch python3-oslo-privsep-1.33.5-1.el8.noarch python3-oslo-reports-1.30.0-1.el8.noarch python3-oslo-rootwrap-5.16.1-1.el8.noarch python3-oslo-serialization-2.29.3-1.el8.noarch python3-oslo-service-1.40.2-2.el8.noarch python3-oslo-upgradecheck-0.3.2-1.el8.noarch python3-oslo-utils-3.41.6-1.el8.noarch python3-oslo-versionedobjects-1.36.1-1.el8.noarch python3-oslo-vmware-2.34.1-1.el8.noarch python3-osprofiler-2.8.2-1.el8.noarch python3-os-resource-classes-0.5.0-1.el8.noarch python3-os-service-types-1.7.0-2.el8.noarch python3-os-traits-0.16.0-1.el8.noarch python3-os-vif-1.17.0-1.el8.noarch python3-os-win-4.3.3-1.el8.noarch python3-os-xenapi-0.3.4-1.el8.noarch python3-ovsdbapp-0.17.5-1.el8.noarch python3-pandas-0.25.3-1.el8.x86_64 python3-paramiko-2.7.1-1.el8.noarch python3-passlib-1.7.1-6.el8.noarch python3-paste-3.2.4-1.el8.noarch python3-paste-deploy-2.0.1-4.el8.noarch python3-pecan-1.3.2-9.el8.noarch python3-pillow-5.1.1-12.el8_2.x86_64 python3-pint-0.10.1-1.el8.noarch python3-placement-2.0.1-1.el8.noarch python3-psutil-5.6.3-5.el8.x86_64 python3-pyasn1-0.4.6-3.el8.noarch python3-pyasn1-modules-0.4.6-3.el8.noarch python3-pycadf-2.10.0-2.el8.noarch python3-pydot-1.4.1-1.el8.noarch python3-pyeclib-1.5.0-12.el8.x86_64 python3-pymongo-3.7.0-1.module_el8.4.0+679+437db172.x86_64 python3-PyMySQL-0.10.1-2.module_el8.4.0+666+456f5f48.noarch python3-pynacl-1.3.0-5.el8.x86_64 python3-pyngus-2.3.0-4.el8.noarch python3-pyparsing-2.4.6-1.el8.noarch python3-pyperclip-1.6.4-6.el8.noarch python3-pyroute2-0.5.6-1.el8.noarch python3-pysaml2-4.5.0-9.el8.noarch python3-pysendfile-2.0.1-15.el8.x86_64 python3-pyxattr-0.5.3-18.el8.x86_64 python3-qpid-proton-0.30.0-1.el8.x86_64 python3-rcssmin-1.0.6-18.el8.x86_64 python3-redis-3.3.8-1.el8.noarch python3-repoze-lru-0.7-6.el8.noarch python3-requestsexceptions-1.4.0-1.el8.noarch python3-retrying-1.2.3-21.el8.noarch python3-rfc3986-1.2.0-6.el8.noarch python3-rjsmin-1.0.12-17.el8.x86_64 python3-routes-2.4.1-12.el8.noarch python3-rpm-generators-5-6.el8.noarch python3-rpm-macros-3-41.el8.noarch python3-rsa-3.4.2-13.el8.noarch python3-rtslib-2.1.74-1.el8.noarch python3-scipy-1.0.0-20.module_el8.4.0+790+083e3d81.x86_64 python3-scrypt-0.8.0-11.el8.x86_64 python3-scss-1.3.5-9.el8.x86_64 python3-secretstorage-3.1.1-4.el8.noarch python3-semantic_version-2.6.0-5.el8.noarch python3-setproctitle-1.1.10-16.el8.x86_64 python3-simplegeneric-0.8.1-17.el8.noarch python3-simplejson-3.17.0-1.el8.x86_64 python3-singledispatch-3.4.0.3-18.el8.noarch python3-soupsieve-1.9.2-3.el8.noarch python3-sqlalchemy-1.3.2-2.module_el8.4.0+666+456f5f48.x86_64 python3-sqlparse-0.2.4-9.el8.noarch python3-statsd-3.2.1-16.el8.noarch python3-stevedore-1.31.0-2.el8.noarch python3-suds-0.7-0.8.94664ddd46a6.el8.noarch python3-swift-2.23.3-1.el8.noarch python3-swiftclient-3.8.1-1.el8.noarch python3-tables-3.5.2-6.el8.x86_64 python3-taskflow-3.7.1-1.el8.noarch python3-tempita-0.5.1-25.el8.noarch python3-tenacity-5.1.1-3.el8.noarch python3-tinyrpc-1.0.3-1.el8.noarch python3-tkinter-3.6.8-37.el8.x86_64 python3-tooz-1.66.3-1.el8.noarch python3-uritemplate-3.0.0-10.el8.noarch python3-urwid-1.3.1-4.el8.x86_64 python3-versiontools-1.9.1-24.el8.noarch python3-vine-1.3.0-4.el8.noarch python3-voluptuous-0.11.7-2.el8.noarch python3-waitress-1.4.2-1.el8.noarch python3-warlock-1.3.3-1.el8.noarch python3-wcwidth-0.1.7-14.el8.noarch python3-webencodings-0.5.1-6.el8.noarch python3-webob-1.8.5-5.el8.noarch python3-websockify-0.9.0-1.el8.noarch python3-webtest-2.0.33-4.el8.noarch python3-werkzeug-0.16.0-1.el8.noarch python3-wrapt-1.11.2-4.el8.x86_64 python3-wsme-0.9.3-1.el8.noarch python3-XStatic-1.0.1-19.el8.noarch python3-XStatic-Angular-1.5.8.0-10.el8.noarch python3-XStatic-Angular-Bootstrap-2.2.0.0-10.el8.noarch python3-XStatic-Angular-FileUpload-12.0.4.0-14.el8.noarch python3-XStatic-Angular-Gettext-2.3.8.0-1.el8.noarch python3-XStatic-Angular-lrdragndrop-1.0.2.2-16.el8.noarch python3-XStatic-Angular-Schema-Form-0.8.13.0-2.el8.noarch python3-XStatic-Bootstrap-Datepicker-1.3.1.0-16.el8.noarch python3-XStatic-Bootstrap-SCSS-3.3.7.1-10.el8.noarch python3-XStatic-bootswatch-3.3.7.0-11.el8.noarch python3-XStatic-D3-3.5.17.0-10.el8.noarch python3-XStatic-Font-Awesome-4.7.0.0-10.el8.noarch python3-XStatic-Hogan-2.0.0.2-17.el8.noarch python3-XStatic-Jasmine-2.4.1.1-9.el8.noarch python3-XStatic-jQuery-1.10.2.1-1.el8.noarch python3-XStatic-JQuery-Migrate-1.2.1.1-17.el8.noarch python3-XStatic-JQuery-quicksearch-2.0.3.1-17.el8.noarch python3-XStatic-JQuery-TableSorter-2.14.5.1-17.el8.noarch python3-XStatic-jquery-ui-1.12.0.1-9.el8.noarch python3-XStatic-JSEncrypt-2.3.1.1-9.el8.noarch python3-XStatic-Magic-Search-0.2.5.1-12.el8.noarch python3-XStatic-mdi-1.4.57.0-13.el8.noarch python3-XStatic-objectpath-1.2.1.0-2.el8.noarch python3-XStatic-Rickshaw-1.5.0.0-19.el8.noarch python3-XStatic-roboto-fontface-0.5.0.0-13.el8.noarch python3-XStatic-smart-table-1.4.13.2-9.el8.noarch python3-XStatic-Spin-1.2.5.2-18.el8.noarch python3-XStatic-termjs-0.0.7.0-9.el8.noarch python3-XStatic-tv4-1.2.7.0-2.el8.noarch python3-yappi-1.0-4.el8.x86_64 python3-zake-0.2.2-18.el8.noarch python3-zipp-0.5.1-2.el8.noarch python3-zmq-18.1.0-2.el8.x86_64 python-django-bash-completion-2.0.13-1.el8.noarch python-openstackclient-lang-4.0.2-1.el8.noarch python-oslo-cache-lang-1.37.1-1.el8.noarch python-oslo-concurrency-lang-3.30.1-1.el8.noarch python-oslo-db-lang-5.0.2-2.el8.noarch python-oslo-i18n-lang-3.24.0-2.el8.noarch python-oslo-log-lang-3.44.3-1.el8.noarch python-oslo-middleware-lang-3.38.1-2.el8.noarch python-oslo-policy-lang-2.3.4-1.el8.noarch python-oslo-privsep-lang-1.33.5-1.el8.noarch python-oslo-utils-lang-3.41.6-1.el8.noarch python-oslo-versionedobjects-lang-1.36.1-1.el8.noarch python-oslo-vmware-lang-2.34.1-1.el8.noarch python-pycadf-common-2.10.0-2.el8.noarch python-rpm-macros-3-41.el8.noarch python-srpm-macros-3-41.el8.noarch qpid-proton-c-0.30.0-1.el8.x86_64 rabbitmq-server-3.8.3-1.el8.x86_64 radvd-2.17-15.el8.x86_64 rest-0.8.1-2.el8.x86_64 roboto-fontface-common-0.5.0.0-13.el8.noarch roboto-fontface-fonts-0.5.0.0-13.el8.noarch scrub-2.5.2-14.el8.x86_64 SDL2-2.0.10-2.el8.x86_64 supermin-5.2.1-1.el8.x86_64 swtpm-0.4.2-1.20201201git2df14e3.el8.x86_64 swtpm-libs-0.4.2-1.20201201git2df14e3.el8.x86_64 swtpm-tools-0.4.2-1.20201201git2df14e3.el8.x86_64 sysfsutils-2.1.0-24.el8.x86_64 syslinux-6.04-5.el8.x86_64 syslinux-extlinux-6.04-5.el8.x86_64 syslinux-extlinux-nonlinux-6.04-5.el8.noarch syslinux-nonlinux-6.04-5.el8.noarch systemd-container-239-45.el8_4.3.x86_64 targetcli-2.1.53-2.el8.noarch target-restore-2.1.74-1.el8.noarch tcl-8.6.8-2.el8.x86_64 texlive-base-20180414-20.el8.noarch texlive-dvipng-20180414-20.el8.x86_64 texlive-kpathsea-20180414-20.el8.x86_64 texlive-lib-20180414-20.el8.x86_64 tk-8.6.8-1.el8.x86_64 urw-base35-bookman-fonts-20170801-10.el8.noarch urw-base35-c059-fonts-20170801-10.el8.noarch urw-base35-d050000l-fonts-20170801-10.el8.noarch urw-base35-fonts-20170801-10.el8.noarch urw-base35-fonts-common-20170801-10.el8.noarch urw-base35-gothic-fonts-20170801-10.el8.noarch urw-base35-nimbus-mono-ps-fonts-20170801-10.el8.noarch urw-base35-nimbus-roman-fonts-20170801-10.el8.noarch urw-base35-nimbus-sans-fonts-20170801-10.el8.noarch urw-base35-p052-fonts-20170801-10.el8.noarch urw-base35-standard-symbols-ps-fonts-20170801-10.el8.noarch urw-base35-z003-fonts-20170801-10.el8.noarch web-assets-filesystem-5-10.el8.noarch wxBase3-3.0.5.1-1.el8.x86_64 wxGTK3-3.0.5.1-1.el8.x86_64 wxGTK3-gl-3.0.5.1-1.el8.x86_64 wxGTK3-i18n-3.0.5.1-1.el8.noarch xdg-utils-1.1.2-5.el8.noarch xinetd-2.3.15-24.el8.x86_64 xorg-x11-fonts-ISO8859-1-100dpi-7.5-19.el8.noarch xorg-x11-font-utils-7.5-40.el8.x86_64 xorg-x11-server-utils-7.7-27.el8.x86_64 xstatic-angular-bootstrap-common-2.2.0.0-10.el8.noarch XStatic-Angular-common-1.5.8.0-10.el8.noarch xstatic-angular-fileupload-common-12.0.4.0-14.el8.noarch xstatic-angular-gettext-common-2.3.8.0-1.el8.noarch xstatic-angular-lrdragndrop-common-1.0.2.2-16.el8.noarch xstatic-angular-schema-form-common-0.8.13.0-2.el8.noarch xstatic-bootstrap-datepicker-common-1.3.1.0-16.el8.noarch xstatic-bootstrap-scss-common-3.3.7.1-10.el8.noarch xstatic-d3-common-3.5.17.0-10.el8.noarch xstatic-hogan-common-2.0.0.2-17.el8.noarch xstatic-jasmine-common-2.4.1.1-9.el8.noarch xstatic-jquery-migrate-common-1.2.1.1-17.el8.noarch xstatic-jquery-quicksearch-common-2.0.3.1-17.el8.noarch xstatic-jquery-tablesorter-common-2.14.5.1-17.el8.noarch xstatic-jquery-ui-common-1.12.0.1-9.el8.noarch xstatic-jsencrypt-common-2.3.1.1-9.el8.noarch XStatic-Magic-Search-common-0.2.5.1-12.el8.noarch xstatic-objectpath-common-1.2.1.0-2.el8.noarch xstatic-rickshaw-common-1.5.0.0-19.el8.noarch xstatic-smart-table-common-1.4.13.2-9.el8.noarch xstatic-spin-common-1.2.5.2-18.el8.noarch xstatic-termjs-common-0.0.7.0-9.el8.noarch xstatic-tv4-common-1.2.7.0-2.el8.noarch yajl-2.1.0-10.el8.x86_64 zeromq-4.3.2-1.el8.x86_64
            dnf install -y network-scripts
            systemctl stop NetworkManager
            systemctl disable NetworkManager
            systemctl enable network
            echo "options kvm_intel nested=1" > /etc/modprobe.d/kvm-nested.conf
            modprobe -r kvm_intel
            modprobe kvm_intel
            rm -rf /etc/sysconfig/network-scripts/ifcfg-ens*
            dnf clean all


  config_send_notify_after_settings:
    type: OS::Heat::SoftwareConfig
    properties:
      config:
        str_replace:
          params:
            __heat_wc_notify: { get_attr: ['wait_handle', 'curl_cli'] }
          template: |
            #!/bin/bash -ex
            __heat_wc_notify --data-binary '{"status": "SUCCESS"}'
            shutdown -h now

  server_init:
    type: OS::Heat::MultipartMime
    properties:
      parts:
      - config: { get_resource: config_set_passwd }
      - config: { get_resource: config_set_reposerver }
      - config: { get_resource: config_init_config }
      - config: { get_resource: config_send_notify_after_settings }

  instance1:
    type: OS::Nova::Server
    properties:
      name: handson-image-CentOS8
      image: CentOS8-orig
      flavor: m1.tiny
      key_name: key-for-build
      networks:
        - port: { get_resource: neutron-port }
      user_data_format: RAW
      user_data: { get_resource: server_init }
