import hudson.model.*

node {
  // The last stage cleans up the local images and workspace
  stage('Housekeeping') {
    deleteDir()
  }

  // The first stage checks out the code from Github
  stage('Get Code') {
    checkout scm
  }

  // Creating VMs
  stage('Build Virtual Machines') {
    dir('preparation/test') {
      sh 'chmod 600 ansible_key'
      sh 'ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -vvv -i ansible_hosts -s --private-key=ansible_key as_mkvms.yaml'
    }
  }

  // Waiting and Preparation
//  stage('Waiting instance and Preparation') {
//      sh 'ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -vvv -i ansible_hosts -s --private-key=ansible_key as_preconfig_vms.yaml'
//  }

}

